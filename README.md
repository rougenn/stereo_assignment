## Stereo assignment: карта глубины из моно и стерео фото (Classic / FoundationStereo / Metric3D)

Этот репозиторий — практический пайплайн для получения **карты глубины (включая метрическую глубину, где возможно)** из фото смартфонов.

Используются три подхода:

* **Стерео-калибровка + выпрямление (rectification)** на OpenCV
* **Классическое стерео**
* **Нейро-стерео** (NVLabs FoundationStereo)
* **Моно-глубина** (Metric3D через ONNX)

---

## Google Colab (основной способ запуска)

Работа предполагается **через Colab-ноутбук**:

**Colab:** [https://colab.research.google.com/drive/1lHf563zep1eqJCucO-BxiZt_OnaN1PLS?usp=sharing](https://colab.research.google.com/drive/1lHf563zep1eqJCucO-BxiZt_OnaN1PLS?usp=sharing)

Как пользоваться:

1. Открой Colab по ссылке и сделай копию себе.
2. **Загрузи свои фото** в папки проекта:
   * `left/` — кадры с “левой” камеры
   * `right/` — кадры с “правой” камеры
3. Проверь, что пары **совпадают по номеру, это очень важно!** (например `left/1.*` ↔ `right/1.*`, …).
4. В начале ноутбука при необходимости поменяй:
   * пути к папкам с фото (если структура у тебя другая)
   * параметры калибровки шахматки (кол-во **внутренних** углов и размер клетки в метрах)
   * целевое разрешение обработки (`TARGET_W`, `TARGET_H`) — если не хватает памяти/скорости
5. Выполни **все ячейки**.

---

## Советы по съёмке (очень влияют на качество)

* **Жёстко закрепи два телефона** (я прикрепил скотчем два телефона к коробке и одновременно нажимал "сфотографировать"). Телефоны не должны смещаться между калибровкой и сценой.
* Отключи всё, что по-разному “улучшает” левый/правый кадр:
  * HDR / night mode / portrait / AI enhancement
  * цифровая стабилизация
* Если доступно — **RAW/DNG** обычно лучше для калибровки и матчинга.
* Для калибровки сделай **10-15 пар фотографий шахматки**:
  * разные расстояния и наклоны
  * шахматка в разных местах кадра (углы/края/центр)
  * без смаза и сильных бликов
* Рекомендуется добавить в сцену с калибровкой **объекты (лучше больше одного) с известной дистанцией** для проверки метрической глубины.

---

## Что будет на выходе

Обычно появляются папки (названия могут немного отличаться в ноутбуке):

* `rectified_photos/left/` и `rectified_photos/right/` — выпрямленные пары
* `rectified_photos/*_calibration_opencv.yml` и `rectified_photos/stereo_calibration_opencv.yml` — результаты калибровки
* `classic_depth_outputs/XX/` — классическое стерео (disparity/depth + визуализации)
* `FoundationStereo_outputs/XX/` — нейро-стерео (disparity/depth + визуализации)
* `metric3d_outputs/...` — моно-глубина

---

## Пример отчёта

Пример оформленного отчёта с результатами и сравнениями:
[https://drive.google.com/file/d/1p0qfBjv1BjJb9Hd-2HtMLLGHAyAqZnQC/view?usp=sharing](https://drive.google.com/file/d/1p0qfBjv1BjJb9Hd-2HtMLLGHAyAqZnQC/view?usp=sharing)
